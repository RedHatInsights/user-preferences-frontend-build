(self.webpackChunkuser_preferences_frontend=self.webpackChunkuser_preferences_frontend||[]).push([[623],{48340:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_e});var r=n(93433),i=n(15861),a=n(4942),o=n(29439),c=n(64687),s=n.n(c),l=n(92950),u=n.n(l),p=n(57557),f=n.n(p),d=n(46118),m=n(83811),v=n(89117),b=n(39173),y=n(83215),h=n(28216),g=n(33366);g.ZP.interceptors.response.use((function(e){var t;if(null!=e&&null!==(t=e.config)&&void 0!==t&&t.data)try{return JSON.parse(e.config.data)}catch(t){return e.config.data}return e}));var O=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"v1",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3?arguments[3]:void 0;return g.ZP.get("/api/".concat(e,"/").concat(t).concat(r||"/user-config/".concat(n)))},E=function(){var e=(0,i.Z)(s().mark((function e(t,n){var r,i,a,o=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:"v1",i=o.length>3&&void 0!==o[3]?o[3]:"",a=o.length>4?o[4]:void 0,e.abrupt("return",g.ZP.post("/api/".concat(t,"/").concat(r).concat(a||"/user-config/".concat(i)),n));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),j=n(36580),P=n(45987),S=n(25091),w=function(e){var t,n,r=e.application,i=e.apiVersion,a=e.resourceType,o=void 0===a?"email-preference":a,c=e.schema,s=e.url,l=e.apiName;return{type:j.aI.GET_EMAIL_SCHEMA,payload:c||O(l||r,i,o,s),meta:{appName:r,notifications:{rejected:{variant:"danger",title:"Request for user's configuration failed",description:"User's configuration email for ".concat(null===(t=S["email-preference"])||void 0===t||null===(n=t[r])||void 0===n?void 0:n.title," application does not exist.")}}}}},Z=n(87462),k=n(94184),N=n.n(k),F=n(45697),D=n.n(F),C=n(41693),x=n(74041),T=["onChange","checked"];function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L=function(e){var t=(0,C.Z)(I(I({},e),{},{type:"checkbox"})),n=t.label,r=t.title,i=t.description,a=t.isDanger,o=t.checkedWarning,c=t.infoMessage,s=t.input,l=s.onChange,p=s.checked,f=(0,P.Z)(s,T);return u().createElement(v.Checkbox,(0,Z.Z)({},f,{isChecked:p,id:"descriptive-checkbox-".concat(f.name),onChange:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];l.apply(void 0,[e,t].concat(r))},"data-type":"descriptive-checkbox",className:"pref-c-descriptive-checkbox",label:u().createElement("span",{className:N()("pref-c-checkbox-label",{"pref-c-checkbox-label-error":a})},n||r),description:u().createElement("div",null,i&&u().createElement(u().Fragment,null,u().createElement("span",{className:"pref-c-checkbox-description"},i)),!p&&c&&u().createElement("span",{className:"pref-c-checkbox-info"},u().createElement(x.InfoCircleIcon,null)," ",c),p&&o&&u().createElement("span",{className:"pref-c-checkbox-warning"},u().createElement(x.ExclamationTriangleIcon,null)," ",o))}))};L.propTypes={FieldProvider:D().any,formOptions:D().any,group:D().string,section:D().string,name:D().string,label:D().string,title:D().string,description:D().string,isDanger:D().bool,isGlobal:D().bool},L.defaultProps={name:"",label:"",isDanger:!1};const _=L;var B=n(35664),A=["name","size","FieldProvider","validate","FormSpyProvider","formOptions"],M=function(e){e.name;var t=e.size,n=(e.FieldProvider,e.validate,e.FormSpyProvider,e.formOptions,(0,P.Z)(e,A));return u().createElement("div",n,u().createElement(B.Z,{size:t}))};M.propTypes={FieldProvider:D().any,formOptions:D().any,FormSpyProvider:D().any,validate:D().any,name:D().string,size:D().string},M.defaultProps={name:"",size:"md"};const V=M;var z=n(15671),H=n(43144),U=n(97326),G=n(60136),q=n(82963),J=n(61120),K=n(48880);var Q=function(e){(0,G.Z)(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,J.Z)(t);if(n){var i=(0,J.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,q.Z)(this,e)});function i(){var e;(0,z.Z)(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),(0,a.Z)((0,U.Z)(e),"state",{hasError:!1}),e}return(0,H.Z)(i,[{key:"componentDidCatch",value:function(e,t){this.setState({hasError:t})}},{key:"render",value:function(){var e=this.props,t=e.fieldsKey,n=e.label,r=e.fields,i=e.formOptions,a=this.state.hasError;return u().createElement(v.DataListItemRow,null,u().createElement(v.DataListItemCells,{dataListCells:[u().createElement(v.DataListCell,{isFilled:!1,className:"pref-c-title pref-u-bold",key:"".concat(t,"-title")},0===t?n:""),u().createElement(v.DataListCell,{isFilled:!0,key:"".concat(t,"-content")},a?"Error while mapping fields, please check your schema if it has valid component types":null==i?void 0:i.renderForm(r,i))]}))}}]),i}(l.Component);Q.propTypes={fieldsKey:D().oneOfType([D().string,D().number]),fields:D().array,FieldProvider:D().any,formOptions:D().any,label:D().node,name:D().string,validate:D().any,FormSpyProvider:D().any};var X=function(e){var t=(0,C.Z)(e),n=t.sections,r=t.label,i=t.name,a=(0,K.default)();return u().createElement(v.DataList,(0,Z.Z)({"aria-label":r||i},e),n.map((function(e,t){var n=e.label,r=e.fields,o=Array.isArray(r)?r:[r];return o.length>0&&u().createElement(v.DataListItem,{name:i,key:t,"aria-labelledby":"simple-item1"},o.map((function(e,r){var i=e.fields;return u().createElement(Q,{key:"".concat(t,"-").concat(r),fieldsKey:r,label:n,fields:i,formOptions:a})})))})))};X.propTypes={sections:D().array,FieldProvider:D().any,formOptions:D().any,label:D().node,name:D().string,validate:D().any,FormSpyProvider:D().any};const Y=X;function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ee=function(e){var t=(0,K.default)(),n=(0,l.useRef)(t.getState().dirtyFields),r=(0,C.Z)($($({},e),{},{type:"button"})),i=r.group,a=r.section,o=(0,Z.Z)({},r.input);return(0,l.useEffect)((function(){var e,r;JSON.stringify(n.current)!==JSON.stringify(t.getState().dirtyFields)&&(t.batch((function(){t.getRegisteredFields().forEach((function(e){!e.includes(re)&&(e.includes(i)&&e.includes(a)||"is_subscribed"===e&&"rhel"===i&&"advisor"==a)&&0==t.getFieldState(e).value&&(r=!0)}))})),t.change(o.name,null!==(e=r)&&void 0!==e&&e),n.current=t.getState().dirtyFields)})),u().createElement(v.Button,(0,Z.Z)({className:"pref-c-bulk-select-button",variant:"secondary"},o,{id:"button-".concat(o.name),onClick:function(){t.batch((function(){t.getRegisteredFields().forEach((function(e){(e.includes(i)&&e.includes(a)||"is_subscribed"===e&&"rhel"===i&&"advisor"==a)&&!e.includes(re)&&t.change(e,o.value)}))})),t.change(o.name,!o.value)}}),1==o.value?"Select all":"Deselect All")};ee.propTypes={group:D().string,section:D().string,name:D().string},ee.defaultProps={name:""};const te=ee;var ne,re="BULK_SELECT_BUTTON",ie=["permissions","url","apiName","apiVersion","localFile"];function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ce,se,le=function(e){var t;return null===(t=S["notification-preference"])||void 0===t?void 0:t[e]},ue=(ce=oe(oe({},null===(ne=insights.chrome)||void 0===ne?void 0:ne.visibilityFunctions),{},{hasLoosePermissions:(se=(0,i.Z)(s().mark((function e(){var t,n,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:[],e.next=3,insights.chrome.getUserPermissions();case 3:return n=e.sent,e.abrupt("return",t.some((function(e){return null==n?void 0:n.find((function(t){return t.permission===e}))})));case 5:case"end":return e.stop()}}),e)}))),function(){return se.apply(this,arguments)})}),oe(oe({},ce),Object.fromEntries(Object.keys(ce).map((function(e){return["!".concat(e),function(){return!ce[e].apply(ce,arguments)}]}))))),pe=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{"email-preference":{}})["email-preference"],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return Object.entries(e).map((function(e){var c=(0,o.Z)(e,2),l=c[0],u=c[1],p=u.permissions,f=u.url,d=u.apiName,m=u.apiVersion,v=u.localFile,b=(0,P.Z)(u,ie),y=!p||function(e){return Promise.all([e].flat().map((function(e){var t,n=e.method,i=e.args;return null==ue||null===(t=ue[n])||void 0===t?void 0:t.call.apply(t,[ue].concat((0,r.Z)(i||[])))}))).then((function(e){return e.every(Boolean)}))}(p);return(0,i.Z)(s().mark((function e(){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve(y);case 2:if(!e.sent){e.next=12;break}if(!v){e.next=11;break}return e.next=7,n(40118)("./".concat(v));case 7:r=e.sent.default,t(w({schema:r,application:l})),e.next=12;break;case 11:t(w({application:l,url:f,apiName:d,apiVersion:m}));case 12:case"end":return e.stop()}}),e)})))(),(0,a.Z)({},l,oe({localFile:v,isVisible:y,url:f,apiName:d,apiVersion:m},b))})).reduce((function(e,t){return oe(oe({},e),t)}),{})},fe=n(334),de=n(66688);function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var be=function(e,t,n){var r,i=new URLSearchParams(null==e||null===(r=e.location)||void 0===r?void 0:r.search),a=Object.fromEntries(i);return t.some((function(e){return e.name===a.bundle&&e.fields.some((function(e){return e.name===a.app}))}))?a:(n.bundle&&n.app&&(i.set("bundle",n.bundle),i.set("app",n.app),e.replace({pathname:e.location.pathname,search:i.toString()})),ve(ve({},a),n))},ye=function(e){var t=e.searchRef,n=e.search,r=e.setSearch,i=e.fields,a=e.onClick,o=(0,fe.useHistory)(),c=(0,l.useMemo)((function(){return be(o,i,{})}),[null==o?void 0:o.location.search]),s=c.bundle,p=c.app;return u().createElement(v.Menu,{isPlain:!0,isScrollable:!0},u().createElement(v.MenuInput,{ref:t,className:"pf-u-mx-sm"},u().createElement(v.TextInput,{"aria-label":"Filter menu items",placeholder:"Search applications",iconVariant:"search",type:"search",onChange:function(e){return r(e)},value:n})),u().createElement(v.Divider,null),u().createElement(v.MenuContent,{id:"notifications-menu-content"},i.some((function(e){return e.fields.length>0}))?i.map((function(e){var t=e.fields,n=e.title,r=e.name;return t.length>0?u().createElement(v.MenuGroup,{label:n,className:"pf-u-px-sm",key:"menu-group-".concat(r)},u().createElement(v.MenuList,null,t.map((function(e){var t=e.label,n=e.name;return u().createElement(v.MenuItem,{onClick:function(e){return a(e,r,n)},key:"menu-item-".concat(r,"-").concat(n),isFocused:s===r&&p===n},t)})))):null})):function(e){return u().createElement(v.EmptyState,{variant:v.EmptyStateVariant.small,className:"pf-u-mt-lg"},u().createElement(v.EmptyStateIcon,{icon:x.SearchIcon}),u().createElement(v.Title,{headingLevel:"h4",size:"lg"},"No matching applications found"),u().createElement(v.EmptyStateBody,null,"Adjust you filters and try again."),u().createElement(v.Button,{variant:v.ButtonVariant.link,onClick:function(){return e("")}},"Clear filters"))}(r)))};ye.propTypes={fields:D().array.isRequired,search:D().string,setSearch:D().func,searchRef:D().object,onClick:D().func};const he=ye;function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ee=function(e){var t,n,i,a,c,s=e.fields,p=e.titleRef,f=(0,fe.useHistory)(),m=(0,d.XQ)(),b=(0,l.useRef)(null),y=(0,l.useRef)({}),h=(0,l.useState)(""),g=(0,o.Z)(h,2),O=g[0],E=g[1],j=(0,l.useState)(s),P=(0,o.Z)(j,2),w=P[0],Z=P[1],k=(0,de.cl)(),N=k.pristine,F=k.submitSucceeded,D=k.dirtyFieldsSinceLastSubmit,C=function(){var e=document.getElementById("notifications-container"),t=document.getElementById("notifications-grid"),n=document.getElementById("notifications-menu-content");if(null!=n&&n.style&&null!=t&&t.style){var r,i,a=(null===(r=document.getElementById("user-pref__form-buttons"))||void 0===r||null===(i=r.getBoundingClientRect())||void 0===i?void 0:i.height)||0;t.style.height="".concat(e.getBoundingClientRect().height-a,"px");var o=e.getBoundingClientRect().height-p.current.getBoundingClientRect().height-b.current.getBoundingClientRect().height-(o<n.scrollHeight?a:0)-1;n.style.maxHeight="".concat(o,"px"),n.style.height="".concat(o-a,"px")}};return(0,l.useEffect)((function(){var e,t,n,r;return window.screen.width>768&&(window.addEventListener("resize",C),C()),y.current=be(f,s,{bundle:null==s||null===(e=s[0])||void 0===e?void 0:e.name,app:null==s||null===(t=s[0])||void 0===t||null===(n=t.fields)||void 0===n||null===(r=n[0])||void 0===r?void 0:r.name}),function(){return window.removeEventListener("resize",C)}}),[]),(0,l.useEffect)((function(){var e=s.reduce((function(e,t){return[].concat((0,r.Z)(e),[Oe(Oe({},t),{},{fields:t.fields.filter((function(e){var t,n,r=O.toLowerCase();return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(r))||(null===(n=e.title)||void 0===n?void 0:n.toLowerCase().includes(r))}),[])})])}),[]);Z(e)}),[O]),(0,l.useEffect)((function(){C()}),[N,F,D]),u().createElement(u().Fragment,null,u().createElement("div",{className:"pref-notifications--nav"},u().createElement(he,{searchRef:b,search:O,setSearch:E,fields:w,onClick:function(e,t,n){e.preventDefault(),y.current={bundle:t,app:n},function(e,t){var n,r=new URLSearchParams(null==e||null===(n=e.location)||void 0===n?void 0:n.search);Object.entries(t).forEach((function(e){var t=(0,o.Z)(e,2),n=t[0],i=t[1];r.set(n,i)})),e.replace({pathname:e.location.pathname,search:r.toString()})}(f,y.current)}})),u().createElement("div",{className:"pref-notifications--inputs"},u().createElement(u().Fragment,null,(a=null===(t=S["notification-preference"][y.current.bundle])||void 0===t?void 0:t.title,c=null===(n=s.reduce((function(e,t){return[].concat((0,r.Z)(e),(0,r.Z)(t.fields))}),[]).filter((function(e){return e.name===y.current.app&&e.bundle===y.current.bundle})))||void 0===n||null===(i=n[0])||void 0===i?void 0:i.label,u().createElement(u().Fragment,null,u().createElement(v.Title,{headingLevel:"h3",size:"xl",className:"pf-u-pb-xs"},"".concat(c," | ").concat(a)),u().createElement(v.Text,{className:"pf-u-mb-xl"},"Configure your ",c," notifications."))),u().createElement("div",null,m.renderForm(s.reduce((function(e,t){return[].concat((0,r.Z)(e),(0,r.Z)(t.fields.map((function(e){return Oe(Oe({},e),{},{key:"form-".concat(e.bundle,"-").concat(e.name),fields:[e.fields.map((function(t){return Oe(Oe({},t),{},{hideField:!(e.name===y.current.app&&e.bundle===y.current.bundle)})}))]})}))))}),[]),m)))))};Ee.propTypes={fields:D().array.isRequired,dataType:D().any,validate:D().any,component:D().any,titleRef:D().any};const je=u().memo(Ee);var Pe=function(e){var t=e.fields,n=(0,d.XQ)();return u().createElement("div",{className:"pf-c-form"},n.renderForm(t,n))};Pe.propTypes={fields:D().array.isRequired};const Se=Pe;function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ke=function(e,t,n){return Object.entries(e).reduce((function(e,i){var a=(0,o.Z)(i,2),c=a[0],s=a[1];return[].concat((0,r.Z)(e),[{title:S["notification-preference"][c].title,name:c,fields:s.sections.reduce((function(e,i){var a=!0,o=[].concat((0,r.Z)(i.fields[0].fields.map((function(e){return a=a&&e.initialValue,Ze(Ze({},e),{},{group:c,section:i.name,category:"notification-preference"})}))),(0,r.Z)(Object.entries(t).reduce((function(e,t){var o,s,l,u,p;return[].concat((0,r.Z)(e),(0,r.Z)(t[0]===i.name&&(null===(o=n[t[0]])||void 0===o?void 0:o.bundle)===c&&(null==t||null===(s=t[1])||void 0===s||null===(l=s.schema)||void 0===l||null===(u=l[0])||void 0===u||null===(p=u.fields)||void 0===p?void 0:p.map((function(e){return a=a&&e.initialValue,Ze(Ze({},e),{},{group:c,section:i.name,category:"email-preference"})})))||[]))}),[])));return[].concat((0,r.Z)(e),[Ze(Ze({},i),{},{bundle:c,component:"tabGroup",fields:[{name:"bundles[".concat(c,"].applications[").concat(i.name,"].notifications[").concat(re,"]"),group:c,section:i.name,initialValue:!a,component:"bulkSelectButton"}].concat((0,r.Z)(o))})])}),[])}])}),[])},Ne=n(41609),Fe=n.n(Ne),De=function(e){var t=e.dirtyFieldsSinceLastSubmit,n=e.submitSucceeded,r=e.pristine,i=(0,K.default)().reset,a=Fe()(t)||!n&&r;return a?null:u().createElement("div",{id:"user-pref__form-buttons",className:"pref-shared--buttons pf-m-9-col-on-md"},u().createElement(v.ActionGroup,{className:"pref-shared--actions pf-u-px-lg pf-u-py-md"},u().createElement(v.Button,{type:"submit",ouiaId:"user-pref__submit-button",isDisabled:a,variant:"primary"},"Save"),u().createElement(v.Button,{variant:"link",ouiaId:"user-pref__reset-button",isDisabled:a,onClick:function(){return i()}},"Cancel")))};De.propTypes={dirtyFieldsSinceLastSubmit:D().shape((0,a.Z)({},D().string,D().oneOfType([D().bool]))),submitSucceeded:D().bool,pristine:D().bool};const Ce=function(e){return u().createElement(d.lP,{subscription:{pristine:!0,submitSucceeded:!0,dirtyFieldsSinceLastSubmit:!0}},(function(t){return u().createElement(De,(0,Z.Z)({},t,e))}))};var xe=function(e){var t=e.schema,n=e.formFields,r=(0,d.XQ)().handleSubmit;return u().createElement("form",{onSubmit:r,style:{display:"contents"}},t.title,n,u().createElement(Ce,null))};xe.propTypes={schema:D().shape({title:D().node}),formFields:D().array};const Te=xe;var Re=n(55140);function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Le(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const _e=function(){var e,t=(0,Re.Z)().auth,n=(0,h.I0)(),c=(0,l.useRef)(null),p=(0,l.useState)(!1),g=(0,o.Z)(p,2),P=g[0],w=g[1],Z=(0,l.useState)({}),k=(0,o.Z)(Z,2),N=k[0],F=k[1],D=(0,h.v9)((function(e){return e.emailReducer})),C=(0,h.v9)((function(e){return Le({bundles:{}},e.notificationsReducer)})).bundles;return(0,l.useEffect)((function(){w(!0),(0,i.Z)(s().mark((function e(){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getUser();case 2:return e.t0=F,e.next=5,pe(S,n);case 5:e.t1=e.sent,(0,e.t0)(e.t1),r=Object.keys(S["notification-preference"]).map((function(e){var t,n;return O(null===(t=le(e))||void 0===t?void 0:t.application,void 0,null===(n=le(e))||void 0===n?void 0:n.resourceType).then((function(t){return{data:t,bundleName:e}}))})),Promise.all(r).then((function(e){var t,r=e.reduce((function(e,t){var n=t.data,r=t.bundleName;return Le(Le({},e),{},(0,a.Z)({},r,null==n?void 0:n.fields[0]))}),{});n((t=r,{type:j.aI.GET_NOTIFICATION_SCHEMAS,payload:t})),w(!1)}));case 9:case"end":return e.stop()}}),e)})))()}),[]),P?null:u().createElement("div",{id:"notifications-container",className:"pref-notifications--container"},u().createElement("div",{className:"pref-notifications--wrapper"},u().createElement("div",{id:"notifications-grid",className:"pref-notifications--grid"},u().createElement("div",{ref:c,className:"pref-notifications--head"},u().createElement(b.Z,{className:"pref-notifications--title sticky",title:"My Notifications"}),u().createElement(v.Text,{className:"pref-notifications--subtitle"},"This service allows you to opt-in and out of receiving notifications. Your Organization Administrator has configured which notifications you can or can not receive in their"," ",u().createElement("a",{href:"/settings/notifications"},"Settings"),".")),u().createElement(d.lT,{componentMapper:Le(Le({},m.YS),{},(e={},(0,a.Z)(e,"descriptiveCheckbox",_),(0,a.Z)(e,"bulkSelectButton",te),(0,a.Z)(e,"loader",V),(0,a.Z)(e,"section",Y),(0,a.Z)(e,"tabs",je),(0,a.Z)(e,"tabGroup",Se),e)),FormTemplate:Te,schema:{fields:[{component:"tabs",name:"notifTabs",titleRef:c,fields:ke(C,D,N)}]},onSubmit:function(e,t){var i=Object.entries(C).reduce((function(e,n){var i=n[1].sections.filter((function(e){return Object.entries(t.getState().dirtyFields).some((function(t){var r=(0,o.Z)(t,2),i=r[0],a=r[1];return i.includes(n[0])&&i.includes(e.name)&&i.includes("notifications")&&a}))})).map((function(e){return e.name})),c=(0,r.Z)(new Set([].concat((0,r.Z)((null==e?void 0:e[n[0]])||[]),(0,r.Z)(i))));return Le(Le({},e),c.length>0?(0,a.Z)({},n[0],c):{})}),{}),c=Object.keys(i).map((function(t){return n(function(e){var t,n,r=e.bundleName,i=e.values,a=e.apiVersion;return{type:j.aI.SAVE_NOTIFICATION_SCHEMA,payload:E(null===(t=le(r))||void 0===t?void 0:t.application,i,a,null===(n=le(r))||void 0===n?void 0:n.resourceType),meta:{bundleName:r,noError:!0}}}({bundleName:t,values:{bundles:(0,a.Z)({},t,{applications:Object.entries(e.bundles[t].applications).reduce((function(e,t){var n=(0,o.Z)(t,2),r=n[0],i=n[1];return Le(Le({},e),{},(0,a.Z)({},r,{notifications:f()(i.notifications,re)}))}),{})})}}))}));if(t.getState().dirtyFields.is_subscribed){var s=N.advisor,l=s.url,u=s.apiName,p=function(e){var t,n,r=e.application,i=e.values,a=e.apiVersion,o=e.resourceType,c=void 0===o?"email-preference":o,s=e.url,l=e.apiName;return{type:j.aI.SAVE_EMAIL_SCHEMA,payload:E(l||r,i,a,c,s),meta:{appName:r,title:null===(t=S["email-preference"])||void 0===t||null===(n=t[r])||void 0===n?void 0:n.title,noError:!0}}}({application:"advisor",values:{is_subscribed:e.is_subscribed},url:l,apiName:u});c.push(n(p))}t.initialize(e),Promise.all(c).then((function(){n((0,y.wN)({dismissable:!0,variant:"success",title:"Notification preferences successfully saved"}))})).catch((function(){n((0,y.wN)({dismissable:!0,variant:"danger",title:"Notification preferences unsuccessfully saved"}))}))}}))))}},40118:(e,t,n)=>{var r={"./config.json":[25091],"./data/general.json":[14298,298],"./data/unsubscribe.json":[17814,814]};function i(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return Promise.all(t.slice(1).map(n.e)).then((()=>n.t(i,19)))}i.keys=()=>Object.keys(r),i.id=40118,e.exports=i},97890:()=>{},44370:()=>{},17657:()=>{},22972:()=>{},45467:()=>{},81754:()=>{},70347:()=>{},11452:()=>{},34946:()=>{},10497:()=>{},32857:()=>{},93818:()=>{},94498:()=>{},10108:()=>{},54476:()=>{},28992:()=>{},80897:()=>{},30187:()=>{},40837:()=>{},90479:()=>{},78752:()=>{},74282:()=>{},98379:()=>{},25238:()=>{},1508:()=>{},91993:()=>{},99624:()=>{},36974:()=>{},27479:()=>{},66822:()=>{},93661:()=>{},56024:()=>{},43390:()=>{},22143:()=>{},314:()=>{},49854:()=>{},40209:()=>{},87234:()=>{},38299:()=>{},72816:()=>{},11177:()=>{},25091:e=>{"use strict";e.exports=JSON.parse('{"email-preference":{"advisor":{"bundle":"rhel","title":"Advisor","url":"/user-preferences/","apiName":"insights","permissions":[{"method":"hasLoosePermissions","args":[["insights:*:*","insights:*:read","advisor:*:*","advisor:*:read","advisor:rules:read"]]}]},"unsubscribe":{"title":"","localFile":"data/unsubscribe.json"}},"notification-preference":{"openshift":{"title":"OpenShift","application":"notifications","resourceType":"notification-preference?bundleName=openshift"},"rhel":{"title":"Red Hat Enterprise Linux","application":"notifications","resourceType":"notification-preference?bundleName=rhel"},"ansible":{"title":"Ansible","application":"notifications","resourceType":"notification-preference?bundleName=ansible"},"console":{"title":"Console","application":"notifications","resourceType":"notification-preference?bundleName=console"}}}')}}]);
//# sourceMappingURL=../sourcemaps/Notifications.fe18cacdb02be2f0ad94a001914329d4.js.map