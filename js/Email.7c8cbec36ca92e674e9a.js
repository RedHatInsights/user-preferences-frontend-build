(self.webpackChunkinsights_frontend_starter_app=self.webpackChunkinsights_frontend_starter_app||[]).push([[542],{41832:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>q});var r,a=n(4942),s=n(87462),i=n(45987),c=n(15861),l=n(29439),o=n(87757),u=n.n(o),m=n(77865),f=n.n(m),p=n(61084),d=n(89235),v=n(86350),h=n(48716),b=n(39173),g=n(57849),E=n(62176),y=n(81797),O=n(25091),w=n(20679),j=n(93433),Z=n(56455),P=[{fields:[{component:y.gI}]}],x=n(83215),k=["permissions","url","apiName","apiVersion","localFile"];function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C,S,_=function(e){return e&&e.loaded?e.schema:P},F=(C=D(D({},null===(r=insights.chrome)||void 0===r?void 0:r.visibilityFunctions),{},{hasLoosePermissions:(S=(0,c.Z)(u().mark((function e(){var t,n,r=arguments;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:[],e.next=3,insights.chrome.getUserPermissions();case 3:return n=e.sent,e.abrupt("return",t.some((function(e){return null==n?void 0:n.find((function(t){return t.permission===e}))})));case 5:case"end":return e.stop()}}),e)}))),function(){return S.apply(this,arguments)})}),D(D({},C),Object.fromEntries(Object.keys(C).map((function(e){return["!".concat(e),function(){return!C[e].apply(C,arguments)}]}))))),L=function(e){return Promise.all([e].flat().map((function(e){var t,n=e.method,r=e.args;return null==F||null===(t=F[n])||void 0===t?void 0:t.call.apply(t,[F].concat((0,j.Z)(r||[])))}))).then((function(e){return e.every(Boolean)}))},V=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{"email-preference":{}},t=e["email-preference"],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};return Object.entries(t).map((function(e){var t=(0,l.Z)(e,2),s=t[0],o=t[1],m=o.permissions,f=o.url,p=o.apiName,d=o.apiVersion,v=o.localFile,h=(0,i.Z)(o,k),b=!m||L(m);return(0,c.Z)(u().mark((function e(){var t;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve(b);case 2:if(!e.sent){e.next=12;break}if(!v){e.next=11;break}return e.next=7,n(40118)("./".concat(v));case 7:t=e.sent.default,r((0,w.Re)({schema:t,application:s})),e.next=12;break;case 11:r((0,w.Re)({application:s,url:f,apiName:p,apiVersion:d}));case 12:case"end":return e.stop()}}),e)})))(),(0,a.Z)({},s,D({localFile:v,isVisible:b,url:f,apiName:p,apiVersion:d},h))})).reduce((function(e,t){return D(D({},e),t)}),{})},T=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return"".concat(e.slice(0,e.length-(e.length>1)).join(", ")).concat(e.length>=2?" and ".concat(e[e.length-1]):"")},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.allSettled(e.map((function(e){return e.promise}))).then((function(t){return t.reduce((function(t,n,r){var s,i,c=n.value;return D(D({},t),{},(0,a.Z)({},c?"success":"error",[].concat((0,j.Z)(t[c?"success":"error"]),[null===(s=e[r])||void 0===s||null===(i=s.meta)||void 0===i?void 0:i.title])))}),{success:[],error:[]})}))},U=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];0!==n.length&&0!==t.length&&(e((0,x.wN)({dismissable:!1,variant:"success",title:"Email preferences for ".concat(T(t)," successfully saved")})),e((0,x.wN)({dismissable:!1,variant:"danger",title:"Email preferences for ".concat(T(n)," unsuccessfully saved")}))),0===n.length&&0!==t.length&&e((0,x.wN)({dismissable:!1,variant:"success",title:"Preferences successfully saved"})),0!==n.length&&0===t.length&&e((0,x.wN)({dismissable:!1,variant:"danger",title:"Preferences unsuccessfully saved"}))},B=n(74209);const R=function(e){var t=(0,m.useState)(!1),n=(0,l.Z)(t,2),r=n[0],a=n[1];return(0,m.useEffect)((function(){(0,c.Z)(u().mark((function t(){return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:a(!0);case 3:case"end":return t.stop()}}),t)})))()}),[]),r},G=function(){var e=insights.chrome.getEnvironment(),t=insights.chrome.isProd?"":"".concat("ci"===e?"qa":e,"."),n=function(){var e=(0,m.useState)({}),t=(0,l.Z)(e,2),n=t[0],r=t[1];return{isLoaded:R((0,c.Z)(u().mark((function e(){var t,n;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,insights.chrome.auth.getUser();case 2:t=e.sent,n=t.identity,r(n.user);case 5:case"end":return e.stop()}}),e)})))),currentUser:n}}(),r=n.isLoaded,a=n.currentUser;return f().createElement(g.Card,{className:"pref-email__info",ouiaId:"user-pref-info-card"},f().createElement(g.CardHeader,null,f().createElement(g.TextContent,null,f().createElement(g.Text,{component:g.TextVariants.h2},"Your information"))),f().createElement(g.CardBody,null,f().createElement(g.DataList,null,f().createElement(g.DataListItem,null,f().createElement(g.DataListItemRow,null,f().createElement(g.DataListItemCells,{className:"pref-u-condensed",dataListCells:[f().createElement(g.DataListCell,{isFilled:!1,className:"pref-c-title pref-u-bold pref-u-condensed",key:"email-title"},"Email address"),f().createElement(g.DataListCell,{isFilled:!0,key:"email-value",className:"pref-email__info-user-email pref-u-condensed"},r?f().createElement(m.Fragment,null,f().createElement("span",{className:"pf-u-mr-md"},a.email),f().createElement("a",{rel:"noopener noreferrer",target:"_blank",href:"https://www.".concat(t,"redhat.com/wapps/ugc/protected/emailChange.html")},"Not correct?")):f().createElement(Z.Z,{size:"lg"}))]}))))))};var z=n(17812),H=["unsubscribe"];function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const q=function(){var e,t=(0,p.useDispatch)(),n=(0,m.useState)({}),r=(0,l.Z)(n,2),o=r[0],j=r[1],x=R((0,c.Z)(u().mark((function e(){return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,insights.chrome.auth.getUser();case 2:return(0,z.z2)(z.jP),e.t0=j,e.next=6,V(O,t);case 6:e.t1=e.sent,(0,e.t0)(e.t1);case 8:case"end":return e.stop()}}),e)})))),k=(0,p.useSelector)((function(e){return e.emailPreferences})),N=function(){var e=(0,c.Z)(u().mark((function e(n){var r,a,s,c,m;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.unsubscribe,r=(0,i.Z)(n,H),a=Object.entries(o).filter((function(e){return!0===(0,l.Z)(e,2)[1].isVisible})).map((function(e){var n,a,s=(0,l.Z)(e,2),i=s[0],c=s[1],o=c.localFile,u=c.schema,m=c.url,f=c.apiName;if(!o&&!u&&null!=k&&null!==(n=k[i])&&void 0!==n&&n.schema&&Object.keys(null==k||null===(a=k[i])||void 0===a?void 0:a.schema).length>0){var p=(0,w.fj)({application:i,values:r,url:m,apiName:f});return t(p),{promise:p.payload,meta:p.meta}}})).filter(Boolean),e.next=4,I(a);case 4:s=e.sent,c=s.success,m=s.error,U(t,c,m);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return f().createElement(f().Fragment,null,f().createElement(h.Z,null,f().createElement(b.Z,{title:"Email preferences"})),f().createElement(v.Z,{className:"pref-email"},f().createElement(g.Stack,{hasGutter:!0},f().createElement(g.StackItem,null,f().createElement(G,null)),f().createElement(g.StackItem,null,f().createElement(g.Card,{ouiaId:"user-pref-email-subscriptions-card"},f().createElement(g.CardHeader,{className:"pf-u-pb-0"},f().createElement(g.TextContent,null,f().createElement(g.Text,{component:g.TextVariants.h2},"Email subscriptions"),f().createElement(g.Text,{component:g.TextVariants.p},"Select the emails you want to receive."))),f().createElement(g.CardBody,{className:"pref-email_form"},x?f().createElement(E.Z,{componentMapper:Y(Y({},d.YS),{},(e={},(0,a.Z)(e,y.L5,y.eU),(0,a.Z)(e,y.gI,y.aN),(0,a.Z)(e,y.GZ,y.RN),e)),FormTemplate:function(e){return f().createElement(d._U,(0,s.Z)({},e,{FormButtons:B.Z}))},schema:{fields:[{name:"email-preferences",component:y.GZ,sections:Object.entries(o).map((function(e){var t=(0,l.Z)(e,2);return function(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};return!0===t.isVisible?{label:null==t?void 0:t.title,name:e,fields:(null==t?void 0:t.fields)||_(n)}:(Promise.resolve(t.isVisible).then(r),{label:f().createElement(Z.Z,null),name:e,fields:P})}(e,t,null==k?void 0:k[e],(function(t){var n=(0,s.Z)({},o);!1===t?delete n[e]:n[e]=Y(Y({},n[e]),{},{isVisible:t}),j(n)}))}(t[0],t[1])}))}]},onSubmit:N}):f().createElement(g.Bullseye,null,f().createElement(g.Spinner,null))))))))}},40118:(e,t,n)=>{var r={"./config.json":[25091],"./data/general.json":[14298,298],"./data/unsubscribe.json":[17814,814]};function a(e){if(!n.o(r,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],a=t[0];return Promise.all(t.slice(1).map(n.e)).then((()=>n.t(a,19)))}a.keys=()=>Object.keys(r),a.id=40118,e.exports=a}}]);
//# sourceMappingURL=../sourcemaps/Email.ecb9f73fbdd17f8677284775c9b1743d.js.map