(self.webpackChunkuserPreferences=self.webpackChunkuserPreferences||[]).push([[2745],{25794:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Le});var a=n(93345),i=n.n(a),s=n(90179),r=n.n(s),l=n(20881),c=n(4963),o=n(29653),m=n(35464),u=n(79704),p=n(80208),d=n(16401),f=n(11830),h=n(9694),b=n(1448),y=n(56496);y.Ay.interceptors.response.use((e=>{if(e?.config?.data)try{return JSON.parse(e.config.data)}catch(t){return e.config.data}return e}));const g=(e,t="v1",n="",a)=>y.Ay.get(`/api/${e}/${t}${a||`/user-config/${n}`}`),v=(e="v1")=>y.Ay.get(`/api/notifications/${e}/user-config/notification-event-type-preference`),E=async(e,t,n="v1",a)=>y.Ay.post(`/api/${e}/${n}${a||"/user-config/notification-event-type-preference"}`,t);var S=n(71966);const C=e=>({type:S.TH.GET_NOTIFICATIONS_SCHEMA,payload:v(e),meta:{notifications:{rejected:{variant:"danger",title:"Request for user's configuration failed",description:"User's configuration notification for this bundle does not exist."}}}}),k=(e,t)=>({type:S.TH.SAVE_NOTIFICATION_SCHEMA,payload:E("notifications",e,t)}),N=({application:e,apiVersion:t,resourceType:n="email-preference",schema:a,url:i,apiName:s})=>({type:S.TH.GET_EMAIL_SCHEMA,payload:a||g(s||e,t,n,i),meta:{appName:e,notifications:{rejected:{variant:"danger",title:"Request for user's configuration failed",description:`User's configuration email for ${e?.label} application does not exist.`}}}});var T=n(58432),F=n(5556),$=n.n(F),O=n(11522),w=n(81558),A=n(51855),L=n.n(A),R=n(54150),x=n.n(R);const P=e=>{const{label:t,title:n,description:a,checkedWarning:s,infoMessage:r,afterChange:l,disabled:c,input:{onChange:o,checked:m,...u}}=(0,O.A)({...e,type:"checkbox"}),p=(0,w.default)();return i().createElement(T.Checkbox,{...u,isChecked:m,isDisabled:c,id:`descriptive-checkbox-${u.name}`,onChange:(e,t,...n)=>{o(e,t,...n),l?.(p,t)},"data-type":"descriptive-checkbox",className:"pref-c-descriptive-checkbox",label:t||n,description:i().createElement("div",null,a&&i().createElement(i().Fragment,null,i().createElement("span",{className:"pref-c-checkbox-description"},a)),!m&&r&&i().createElement("span",{className:"pref-c-checkbox-info"},i().createElement(x(),null)," ",r),m&&s&&i().createElement("span",{className:"pref-c-checkbox-warning"},i().createElement(L(),null)," ",s))})};P.propTypes={FieldProvider:$().any,formOptions:$().any,group:$().string,section:$().string,name:$().string,label:$().string,title:$().string,description:$().string,afterChange:$().func},P.defaultProps={name:"",label:""};const _=P;var j=n(28868);const I=({name:e,size:t,FieldProvider:n,validate:a,FormSpyProvider:s,formOptions:r,...l})=>i().createElement("div",{...l},i().createElement(j.A,{size:t}));I.propTypes={FieldProvider:$().any,formOptions:$().any,FormSpyProvider:$().any,validate:$().any,name:$().string,size:$().string},I.defaultProps={name:"",size:"md"};const M=I;var B=n(13858);class D extends a.Component{state={hasError:!1};componentDidCatch(e,t){this.setState({hasError:t})}render(){const{fieldsKey:e,label:t,fields:n,formOptions:a}=this.props,{hasError:s}=this.state;return i().createElement(B.DataListItemRow,null,i().createElement(B.DataListItemCells,{dataListCells:[i().createElement(B.DataListCell,{isFilled:!1,className:"pref-c-title pref-u-bold",key:`${e}-title`},0===e?t:""),i().createElement(B.DataListCell,{isFilled:!0,key:`${e}-content`},s?"Error while mapping fields, please check your schema if it has valid component types":a?.renderForm(n,a))]}))}}D.propTypes={fieldsKey:$().oneOfType([$().string,$().number]),fields:$().array,FieldProvider:$().any,formOptions:$().any,label:$().node,name:$().string,validate:$().any,FormSpyProvider:$().any};const V=e=>{const{sections:t,label:n,name:a}=(0,O.A)(e),s=(0,w.default)();return i().createElement(B.DataList,{"aria-label":n||a,...e},t.map((({label:e,fields:t},n)=>{const r=Array.isArray(t)?t:[t];return r.length>0&&i().createElement(B.DataListItem,{name:a,key:n,"aria-labelledby":"simple-item1"},r.map((({fields:t},a)=>i().createElement(D,{key:`${n}-${a}`,fieldsKey:a,label:e,fields:t,formOptions:s}))))})))};V.propTypes={sections:$().array,FieldProvider:$().any,formOptions:$().any,label:$().node,name:$().string,validate:$().any,FormSpyProvider:$().any};const H=V;var U=n(92982);const z=e=>{const t=(0,w.default)(),{input:n,section:a,onClick:s}=(0,O.A)({...e,type:"button"});return i().createElement(U.Button,{className:"pref-c-bulk-select-button",variant:"secondary",...n,id:`bulk-select-${a}`,onClick:()=>s?.(t,n)},n.value?"Select":"Deselect"," all")};z.propTypes={section:$().string,onClick:$().func};const G=z;var W=n(17178);const q=({fields:e,label:t,level:n,description:a})=>{const s=(0,c.WZ)();return i().createElement(W.FormGroup,{className:"pref-c-input-"+(1===n?"category":"group"),label:t},a?i().createElement(p.Text,{className:"pf-u-pb-md"},a):null,s.renderForm(e,s))};q.propTypes={fields:$().array.isRequired,label:$().string,level:$().number,description:$().string};const K=q,Z="BULK_SELECT_BUTTON",Y="descriptiveCheckbox",J="loader",Q="section",X="inputGroup",ee="tabs",te="tabGroup",ne=(ae={...insights.chrome?.visibilityFunctions,hasLoosePermissions:async(e=[])=>{const t=await insights.chrome.getUserPermissions();return e.some((e=>t?.find((({permission:t})=>t===e))))}},{...ae,...Object.fromEntries(Object.keys(ae).map((e=>[`!${e}`,(...t)=>!ae[e](...t)])))});var ae;const ie=({"email-preference":e}={"email-preference":{}},t=()=>{})=>Object.entries(e).map((([e,{permissions:a,url:i,apiName:s,apiVersion:r,localFile:l,...c}])=>{const o=!a||(e=>Promise.all([e].flat().map((({method:e,args:t})=>ne?.[e]?.(...t||[])))).then((e=>e.every(Boolean))))(a);return(async()=>{if(await Promise.resolve(o))if(l){const a=(await n(99197)(`./${l}`)).default;t(N({schema:a,application:e}))}else t(N({application:e,url:i,apiName:s,apiVersion:r}))})(),{[e]:{localFile:l,isVisible:o,url:i,apiName:s,apiVersion:r,...c}}})).reduce(((e,t)=>({...e,...t})),{});var se=n(7174),re=n(63068),le=n(77694),ce=n(90952);const oe=(e,t,n,a)=>{const i=new URLSearchParams(e?.search),s=Object.fromEntries(i);return n.some((e=>e.name===s.bundle&&e.fields.some((e=>e.name===s.app))))?s:(a.bundle&&a.app&&(i.set("bundle",a.bundle),i.set("app",a.app),t({pathname:e.pathname,search:i.toString()},{replace:!0})),{...s,...a})};var me=n(2832),ue=n(95010),pe=n(26112),de=n(13344),fe=(n(83168),n(20079)),he=n.n(fe);const be=({searchRef:e,search:t,setSearch:n,fields:s,onClick:r})=>{const l=(0,le.useLocation)(),c=(0,le.useNavigate)(),{bundle:o,app:m}=(0,a.useMemo)((()=>oe(l,c,s,{})),[l.search]);return i().createElement(pe.Menu,{isPlain:!0,isScrollable:!0},i().createElement(pe.MenuSearch,null,i().createElement(pe.MenuSearchInput,{ref:e,className:"pf-u-mx-sm"},i().createElement(de.SearchInput,{"data-testid":"search-input","aria-label":"Filter menu items",placeholder:"Search services",customIcon:i().createElement(he(),null),type:"search",onChange:(e,t)=>n(t),onClear:e=>n(""),value:t}))),i().createElement(me.Divider,null),i().createElement(pe.MenuContent,{id:"notifications-menu-content"},s.some((e=>e.fields.length>0))?s.map((({fields:e,title:t,name:n})=>e.length>0?i().createElement(pe.MenuGroup,{label:t,className:"pf-u-px-sm",key:`menu-group-${n}`},i().createElement(pe.MenuList,null,e.map((({label:e,name:t})=>i().createElement(pe.MenuItem,{onClick:e=>r(e,n,t),key:`menu-item-${n}-${t}`,isFocused:o===n&&m===t},e))))):null)):(e=>i().createElement(ue.EmptyState,{variant:ue.EmptyStateVariant.sm,className:"pf-u-mt-lg"},i().createElement(ue.EmptyStateHeader,{titleText:"No matching services found",icon:i().createElement(ue.EmptyStateIcon,{icon:he()}),headingLevel:"h4"}),i().createElement(ue.EmptyStateBody,null,"Adjust your filters and try again."),i().createElement(ue.EmptyStateFooter,null,i().createElement(U.Button,{variant:U.ButtonVariant.link,onClick:()=>e("")},"Clear filters"))))(n)))};be.propTypes={fields:$().array.isRequired,search:$().string,setSearch:$().func,searchRef:$().object,onClick:$().func};const ye=be,ge=({fields:e,titleRef:t,bundles:n})=>{const s=(0,le.useLocation)(),r=(0,le.useNavigate)(),l=(0,c.WZ)(),o=(0,a.useRef)(null),m=(0,a.useRef)({}),[u,d]=(0,a.useState)(""),[f,h]=(0,a.useState)(e),{pristine:b,submitSucceeded:y,dirtyFieldsSinceLastSubmit:g}=(0,ce.lN)(),v=()=>{const e=document.getElementById("notifications-container"),n=document.getElementById("notifications-grid"),a=document.getElementById("notifications-menu-content");if(a?.style&&n?.style){const i=document.getElementById("user-pref__form-buttons")?.getBoundingClientRect()?.height||0;n.style.height=e.getBoundingClientRect().height-i+"px";const s=e.getBoundingClientRect().height-t.current.getBoundingClientRect().height-o.current.getBoundingClientRect().height-(a.style.height<a.scrollHeight?i:0)-1;a.style.maxHeight=`${s}px`,a.style.height=s-i+"px"}};return(0,a.useEffect)((()=>(window.screen.width>768&&(window.addEventListener("resize",v),v()),m.current=oe(s,r,e,{bundle:e?.[0]?.name,app:e?.[0]?.fields?.[0]?.name}),()=>window.removeEventListener("resize",v))),[]),(0,a.useEffect)((()=>{const t=e.reduce(((e,t)=>[...e,{...t,fields:t.fields.filter((e=>{const t=u.toLowerCase();return e.name?.toLowerCase().includes(t)||e.title?.toLowerCase().includes(t)}),[])}]),[]);h(t)}),[u]),(0,a.useEffect)((()=>{v()}),[b,y,g]),i().createElement(i().Fragment,null,i().createElement("div",{className:"pref-notifications--nav"},i().createElement(ye,{searchRef:o,search:u,setSearch:d,fields:f,onClick:(e,t,n)=>{e.preventDefault(),m.current={bundle:t,app:n},((e,t,n)=>{let a=new URLSearchParams(e?.search);Object.entries(n).forEach((([e,t])=>{a.set(e,t)})),t({pathname:e.pathname,search:a.toString()},{replace:!0})})(s,r,m.current)}})),i().createElement("div",{className:"pref-notifications--inputs"},i().createElement(i().Fragment,null,(E=n[m.current.bundle]?.label,S=e.reduce(((e,t)=>[...e,...t.fields]),[]).filter((e=>e.name===m.current.app&&e.bundle===m.current.bundle))?.[0]?.label,i().createElement(i().Fragment,null,i().createElement(re.Title,{headingLevel:"h3",size:"xl",className:"pf-u-pb-xs"},`${S} | ${E}`),i().createElement(p.Text,{className:"pf-u-mb-md"},"Configure your ",S," notifications."))),i().createElement("div",null,l.renderForm(e.reduce(((e,t)=>[...e,...t.fields.map((e=>({...e,key:`form-${e.bundle}-${e.name}`,fields:[e.fields.map((t=>({...t,hideField:!(e.name===m.current.app&&e.bundle===m.current.bundle)})))]})))]),[]),l)))));var E,S};ge.propTypes={fields:$().array.isRequired,titleRef:$().any,bundles:$().shape({label:$().string})};const ve=i().memo(ge),Ee=({fields:e})=>{const t=(0,c.WZ)();return i().createElement("div",{className:"pf-c-form"},t.renderForm(e,t))};Ee.propTypes={fields:$().array.isRequired};const Se=Ee,Ce=(e,t,n,a)=>{t?Object.entries(e.getState().values.bundles?.[n]?.applications?.[a].eventTypes||{}).every((([e,t])=>e===Z||t))&&("rhel"!==n&&"advisor"!==a||e.getState().values.is_subscribed)&&e.change(`bundles[${n}].applications[${a}].eventTypes[${Z}]`,!1):e.change(`bundles[${n}].applications[${a}].eventTypes[${Z}]`,!0)},ke=(e,t,n)=>Object.entries(e).reduce(((e,[a,i])=>[...e,{title:i?.label,name:a,fields:Object.entries(i.applications).reduce(((e,[i,s])=>{let l=!0;const c=[...Object.entries(t).reduce(((e,t)=>[...e,...t[0]===i&&n[t[0]]?.bundle===a?[{label:"Reports",name:"email-reports",component:X,level:1,fields:t[1].schema[0]?.fields?.map((e=>(l=l&&e.initialValue,{...r()(e,["infoMessage","checkedWarning"]),afterChange:(e,t)=>Ce(e,t,a,i)})))}]||0:[]]),[]),{label:"Event notifications",description:"Select how would you like to receive notifications for each event.",name:"event-notifications",component:X,level:1,fields:[...s.eventTypes.map(((e,t)=>({label:e.label,name:`${e.name}-${t}`,component:X,fields:e.fields.map((e=>(l=l&&e.initialValue,{...r()(e,["description","infoMessage","checkedWarning"]),afterChange:(e,t)=>Ce(e,t,a,i)})))})))]}];return[...e,{name:i,bundle:a,label:s.label,component:te,fields:[{name:`bundles[${a}].applications[${i}].eventTypes[${Z}]`,section:i,initialValue:!l,component:Z,onClick:(e,t)=>{e.batch((()=>{e.getRegisteredFields().forEach((n=>{(n.includes(a)&&n.includes(i)||"is_subscribed"===n&&"rhel"===a&&"advisor"==i)&&!n.includes(Z)&&e.change(n,t.value)}))})),t.onChange(!t.value)}},...c]}]}),[])}]),[]);var Ne=n(41939),Te=n(2543);const Fe=({dirtyFieldsSinceLastSubmit:e,submitSucceeded:t,pristine:n})=>{const{reset:a}=(0,w.default)(),s=(0,Te.isEmpty)(e)||!t&&n;return s?null:i().createElement("div",{id:"user-pref__form-buttons",className:"pref-shared--buttons pf-m-9-col-on-md"},i().createElement(W.ActionGroup,{className:"pref-shared--actions pf-u-px-lg pf-u-py-md"},i().createElement(U.Button,{type:"submit",ouiaId:"user-pref__submit-button",isDisabled:s,variant:"primary"},"Save"),i().createElement(U.Button,{variant:"link",ouiaId:"user-pref__reset-button",isDisabled:s,onClick:()=>a()},"Cancel")))};Fe.propTypes={dirtyFieldsSinceLastSubmit:$().shape({[$().string]:$().oneOfType([$().bool])}),submitSucceeded:$().bool,pristine:$().bool};const $e=e=>i().createElement(c.Pc,{subscription:{pristine:!0,submitSucceeded:!0,dirtyFieldsSinceLastSubmit:!0}},(t=>i().createElement(Fe,{...t,...e})));var Oe=n(93285);const we=({schema:e,formFields:t})=>{const n=(0,c.WZ)(),[s,r]=(0,a.useState)(!1),{chromeHistory:o}=(0,l.A)(),[m,u]=(0,a.useState)({confirmed:!1,pathname:"",search:""}),p=(0,a.useCallback)(((e,t)=>t.length>0?o.push({pathname:e,search:t}):o.push(e)),[o]);return(0,a.useEffect)((()=>{const e=!n.getState().dirty||m.confirmed||m.search.length>0;e&&p(m.pathname,m.search);const t=o.block((({location:t})=>(!n.getState().dirty||0!==t.search?.length||t.pathname?.includes(Oe.A.notifications.link)&&t.pathname?.includes("user-preferences")||r(!0),u((e=>({...e,pathname:t.pathname,search:t.search}))),e)));return()=>{t()}}),[m.confirmed,m.pathname,m.search]),i().createElement(i().Fragment,null,i().createElement(Ne.A,{isOpen:s,title:"Unsaved changes",onConfirm:()=>{u((e=>({...e,confirmed:!0}))),r(!1)},onClose:()=>r(!1)},"Your page contains unsaved changes. Do you want to leave?"),i().createElement("form",{onSubmit:n.handleSubmit,style:{display:"contents"}},e.title,t,i().createElement($e,null)))};we.propTypes={schema:$().shape({title:$().node}),formFields:$().array};const Ae=we,Le=()=>{const{auth:e}=(0,l.A)(),t=(0,b.wA)(),n=(0,a.useRef)(null),[s,y]=(0,a.useState)({}),g=(0,b.Pj)(),v=(0,b.d4)((({emailReducer:e})=>e)),{bundles:N,loaded:T}=(0,b.d4)((({notificationsReducer:e})=>({...e,bundles:Object.entries(e?.bundles||{})?.reduce(((e,[t,n])=>({...e,[t]:n})),{})})));return(0,a.useEffect)((()=>{(async()=>{await e.getUser(),y(ie(se,t)),t(C())})()}),[]),T&&Object.values(v).every((e=>e.loaded))?i().createElement("div",{id:"notifications-container",className:"pref-notifications--container"},i().createElement("div",{className:"pref-notifications--wrapper"},i().createElement("div",{id:"notifications-grid",className:"pref-notifications--grid"},i().createElement("div",{ref:n,className:"pref-notifications--head"},i().createElement(d.A,{className:"pref-notifications--title sticky",title:"My Notifications"}),i().createElement(p.Text,{className:"pref-notifications--subtitle"},"Opt in or out of receiving notifications, and choose how you want to be notified. Your Organization Administrator has configured which notifications you can or can’t receive in their"," ",i().createElement("a",{href:"/settings/notifications"},"Settings"),".",i().createElement(h.ScalprumComponent,{module:"./ConnectedTimeConfig",scope:"notifications",store:g}))),i().createElement(c.SA,{componentMapper:{...o.Tt,[Y]:_,[Z]:G,[J]:M,[Q]:H,[X]:K,[ee]:ve,[te]:Se},FormTemplate:Ae,schema:{fields:[{component:ee,name:"notifTabs",titleRef:n,bundles:N,fields:ke(N,v,s)}]},onSubmit:(e,n)=>{const a={bundles:Object.entries(e.bundles).reduce(((e,[t,n])=>({...e,[t]:{applications:Object.entries(n.applications).reduce(((e,[t,n])=>({...e,[t]:{eventTypes:r()(n.eventTypes,Z)}})),{})}})),{})},i=[t(k(a))],l=n.getState().dirtyFields.is_subscribed;if(l){const{url:n,apiName:a}=s.advisor,r=(({application:e,values:t,apiVersion:n,url:a,apiName:i})=>({type:S.TH.SAVE_EMAIL_SCHEMA,payload:E(i||e,t,n,a),meta:{appName:e,title:e?.label}}))({application:"advisor",values:{is_subscribed:e.is_subscribed},url:n,apiName:a});i.push(t(r))}Promise.all(i).then((()=>{l&&y(ie(se,t)),t(C()),t((0,f.z8)({dismissable:!0,variant:"success",title:"Notification preferences successfully saved"}))})).catch((()=>{t((0,f.z8)({dismissable:!0,variant:"danger",title:"Notification preferences unsuccessfully saved"}))}))}})))):i().createElement(m.Bullseye,null,i().createElement(u.Spinner,null))}},99197:(e,t,n)=>{var a={"./config.json":[7174],"./data/general.json":[37175,7175],"./data/unsubscribe.json":[4686,4686]};function i(e){if(!n.o(a,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=a[e],i=t[0];return Promise.all(t.slice(1).map(n.e)).then((()=>n.t(i,19)))}i.keys=()=>Object.keys(a),i.id=99197,e.exports=i},25823:()=>{},16369:()=>{},62275:()=>{},89205:()=>{},20681:()=>{},79826:()=>{},95067:()=>{},56905:()=>{},26078:()=>{},27077:()=>{},2580:()=>{}}]);